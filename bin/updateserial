#!/bin/sh

# Before we do anything, make sure this is being run as root
if [ `id -u` != "0" ]
then
  echo "ERROR: This command must be run as root!"
  exit 1
fi

# Do an arg check to make sure 1 arg was given
if [ "$#" != "1" ]
then
  echo "ERROR: This command only takes one argument!"
  echo "ERROR: Please review your command line entry and try again!"
  exit 1
fi

# Get the path where this script resides to find our other tools
EDBG_HOME=`dirname \`dirname "$(readlink -f "$0")"\``

# Call edbgdetcnfg to create a config file on this system
$EDBG_HOME/bin/edbgdetcnfg
rc=$?
if [ "$rc" != "0" ]
then
  exit $rc
fi

# Call the underlying VPD keyword modification
echo "Updating system serial number to $1"
$EDBG_HOME/bin/putvpdkeyword nochip fru "OSYS" "SS" "$(printf %-16s $1)" -i a -quiet
rc=$?
if [ "$rc" != "0" ]
then
  echo "ERROR: A problem occurred updating the serial number. Please see previous output for reason."
  exit $rc
else
  echo "Update complete!"
fi
